"use strict";(self.webpackChunksanchonet=self.webpackChunksanchonet||[]).push([[3513],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},c=Object.keys(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),l=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=l(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,c=e.originalType,s=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),p=l(a),h=o,m=p["".concat(s,".").concat(h)]||p[h]||u[h]||c;return a?n.createElement(m,i(i({ref:t},d),{},{components:a})):n.createElement(m,i({ref:t},d))}));function m(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var c=a.length,i=new Array(c);i[0]=h;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[p]="string"==typeof e?e:o,i[1]=r;for(var l=2;l<c;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},1781:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>c,metadata:()=>r,toc:()=>l});var n=a(7462),o=(a(7294),a(3905));const c={sidebar_label:"Create governance actions",title:"Governance actions",sidebar_position:9,slug:"/tutorials/actions"},i=void 0,r={unversionedId:"tutorials/actions",id:"tutorials/actions",title:"Governance actions",description:"Common aspects of all types of governance actions",source:"@site/docs/tutorials/actions.mdx",sourceDirName:"tutorials",slug:"/tutorials/actions",permalink:"/tutorials/actions",draft:!1,editUrl:"https://github.com/input-output-hk/sanchonet/tree/master/docs/tutorials/actions.mdx",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_label:"Create governance actions",title:"Governance actions",sidebar_position:9,slug:"/tutorials/actions"},sidebar:"docsSidebar",previous:{title:"Generate committee keys",permalink:"/tutorials/committee"},next:{title:"Voting on actions",permalink:"/tutorials/vote-action"}},s={},l=[{value:"Common aspects of all types of governance actions",id:"common-aspects-of-all-types-of-governance-actions",level:2},{value:"Update committee actions",id:"update-committee-actions",level:2},{value:"Update committee to <em>add</em> a new CC member:",id:"update-committee-to-add-a-new-cc-member",level:4},{value:"Update committee to <em>remove</em> an existing CC member:",id:"update-committee-to-remove-an-existing-cc-member",level:4},{value:"Update committee to only change the <em>threshold</em>:",id:"update-committee-to-only-change-the-threshold",level:4},{value:"Updating the constitution",id:"updating-the-constitution",level:2},{value:"Find the last enacted Constitution governance action",id:"find-the-last-enacted-constitution-governance-action",level:4},{value:"Prepare the constiuttion anchor.",id:"prepare-the-constiuttion-anchor",level:4},{value:"The guardrails script",id:"the-guardrails-script",level:4},{value:"Create the proposal to update the constitution:",id:"create-the-proposal-to-update-the-constitution",level:4},{value:"Motion of no confidence",id:"motion-of-no-confidence",level:2},{value:"Create a no-confidence governance action:",id:"create-a-no-confidence-governance-action",level:4},{value:"Treasury withdrawal",id:"treasury-withdrawal",level:2},{value:"Create the treasury withdrawal proposal:",id:"create-the-treasury-withdrawal-proposal",level:4},{value:"Info",id:"info",level:2},{value:"Create the &#39;info&#39; governance action:",id:"create-the-info-governance-action",level:4},{value:"Update protocol parameters",id:"update-protocol-parameters",level:2},{value:"Submitting the action file in a transaction",id:"submitting-the-action-file-in-a-transaction",level:2},{value:"Submitting a treasuy-withdrawal and protocol-parameter-update governance action",id:"submitting-a-treasuy-withdrawal-and-protocol-parameter-update-governance-action",level:2},{value:"Balance the transaction:",id:"balance-the-transaction",level:4},{value:"Build, sign and submit the transaction",id:"build-sign-and-submit-the-transaction",level:4},{value:"Finding the governance action ID of your proposal",id:"finding-the-governance-action-id-of-your-proposal",level:2}],d={toc:l},p="wrapper";function u(e){let{components:t,...a}=e;return(0,o.kt)(p,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"common-aspects-of-all-types-of-governance-actions"},"Common aspects of all types of governance actions"),(0,o.kt)("p",null,"A proposal is the process of putting together all the information required to submit a governance action to the chain. A proposal consists of:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A deposit"),(0,o.kt)("li",{parentName:"ul"},"The reward account that will receive the deposit return"),(0,o.kt)("li",{parentName:"ul"},"The governance action"),(0,o.kt)("li",{parentName:"ul"},"An anchor")),(0,o.kt)("p",null,"When using the ",(0,o.kt)("inlineCode",{parentName:"p"},"cardano-cli")," to create a governance action, you will notice that it creates a proposal."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Deposit and stake credentials")),(0,o.kt)("p",null,"Any ada holder can submit a governance action to the chain. They must provide a deposit, which will be returned when the action is finalized (whether it is ratified or has expired).\nTo facilitate this process, the proposer must specify the stake credential that will receive the refunded deposit."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Previous governance action ID")),(0,o.kt)("p",null,"To prevent unintended conflicts between governance actions of the same type, some governance actions must include the governance action ID of\nthe most recently enacted action of its respective type. Notably, this requirement does not apply to ",(0,o.kt)("strong",{parentName:"p"},"treasury withdrawal")," and ",(0,o.kt)("strong",{parentName:"p"},"info")," governance actions."),(0,o.kt)("p",null,"You can get the last enacted governance action IDs with:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway query gov-state --testnet-magic 4 | jq -r .nextRatifyState.nextEnactState.prevGovActionIds\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Committee": {\n    "govActionIx": 0,\n    "txId": "fe2c99fe6bc75a9666427163d51ae7dbf5a60df40135361b7bfd53ac6c7912ec"\n  },\n  "Constitution": {\n    "govActionIx": 0,\n    "txId": "2bcf2a93cb840d72e6fbbad4d52419fa69a3971dee2e32fab414e32a44ecbaf7"\n  },\n  "HardFork": null,\n  "PParamUpdate": null\n}\n')),(0,o.kt)("p",null,"Please note that both the ",(0,o.kt)("strong",{parentName:"p"},"update committee")," and ",(0,o.kt)("strong",{parentName:"p"},"motion of no confidence")," actions share the same space, referred to as 'pgaCommittee,' within the\ngovernance state. Consequently, the governance state stores a single value to represent both of these actions. The system also verifies either of these\nactions against this single stored value."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Anchors")),(0,o.kt)("p",null,"When proposing a governance action, the proposer may employ an ",(0,o.kt)("em",{parentName:"p"},"anchor"),", which comprises a ",(0,o.kt)("em",{parentName:"p"},"URL")," hosting a document that outlines the rationale\nfor the proposed changes, along with the document's ",(0,o.kt)("em",{parentName:"p"},"hash"),"."),(0,o.kt)("p",null,"The document at the URL can be of a free form. It's important that it should communicate to ada holders the ",(0,o.kt)("em",{parentName:"p"},"what")," and the ",(0,o.kt)("em",{parentName:"p"},"why")," of the proposal. This tutorial mostly uses '",(0,o.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/Ryun1/metadata/main/cip108/treasury-withdrawal.jsonld'"},"https://raw.githubusercontent.com/Ryun1/metadata/main/cip108/treasury-withdrawal.jsonld'")," as an example, see ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Ryun1/CIPs/blob/governance-metadata-actions/CIP-0108/test-vector.md"},"here")," for more details."),(0,o.kt)("p",null,"See ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cardano-foundation/CIPs/tree/master/CIP-0100"},"CIP-100 | Governance Metadata")," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cardano-foundation/CIPs/pull/632"},"CIP-0108? | Governance Metadata - Governance Actions")," for standard.\nFollowing CIP-100, we canonize the metadata anchor first, via ",(0,o.kt)("a",{parentName:"p",href:"https://json-ld.org/playground/"},"JSON-LD playground"),", which we then hash."),(0,o.kt)("p",null,"You can use ",(0,o.kt)("inlineCode",{parentName:"p"},"cardano-cli")," to get the hash:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway governance hash anchor-data --file-text treasury-withdrawal.canonical\n931f1d8cdfdc82050bd2baadfe384df8bf99b00e36cb12bfb8795beab3ac7fe5\n")),(0,o.kt)("p",null,"Alternatively, utilize b2sum to hash the document:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"b2sum -l 256 treasury-withdrawal.canonical\n931f1d8cdfdc82050bd2baadfe384df8bf99b00e36cb12bfb8795beab3ac7fe5  treasury-withdrawal.canonical\n")),(0,o.kt)("p",null,"You will need to supply the hash of the document when creating a governance action."),(0,o.kt)("h2",{id:"update-committee-actions"},"Update committee actions"),(0,o.kt)("h4",{id:"update-committee-to-add-a-new-cc-member"},"Update committee to ",(0,o.kt)("em",{parentName:"h4"},"add")," a new CC member:"),(0,o.kt)("p",null,"Assume you want to add three CC members, who have generated cold keys and have provided their key hashes:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"89181f26b47c3d3b6b127df163b15b74b45bba7c3b7a1d185c05c2de")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ea8738081fca0726f4e781f5e55fda05f8745432a5f8a8d09eb0b34b")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"7f6721067362d4ae9ca73469fe983ce5572dad9028386100104b0da0"))),(0,o.kt)("p",null,"You can create a proposal to add them as new CC members with an expiration epoch (",(0,o.kt)("inlineCode",{parentName:"p"},"--epoch"),") for each of them. This is a good time to review the quorum. Let\u2019s assume that 2/3 of the committee needs to accept the proposal:"),(0,o.kt)("p",null,"Create the governance action proposal:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway governance action update-committee \\\n  --testnet \\\n  --governance-action-deposit $(cardano-cli conway query gov-state --testnet-magic 4 | jq -r '.currentPParams.govActionDeposit') \\\n  --deposit-return-stake-verification-key-file stake.vkey \\\n  --anchor-url https://raw.githubusercontent.com/Ryun1/metadata/main/cip108/treasury-withdrawal.jsonld \\\n  --anchor-data-hash 931f1d8cdfdc82050bd2baadfe384df8bf99b00e36cb12bfb8795beab3ac7fe5 \\\n  --add-cc-cold-verification-key-hash 89181f26b47c3d3b6b127df163b15b74b45bba7c3b7a1d185c05c2de \\\n  --epoch 100 \\\n  --add-cc-cold-verification-key-hash ea8738081fca0726f4e781f5e55fda05f8745432a5f8a8d09eb0b34b \\\n  --epoch 95 \\\n  --add-cc-cold-verification-key-hash 7f6721067362d4ae9ca73469fe983ce5572dad9028386100104b0da0 \\\n  --epoch 90 \\\n  --threshold 2/3 \\\n  --out-file update-committee.action\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Note: If there is a ",(0,o.kt)("strong",{parentName:"li"},"previously enacted")," governance action to update the committee, the proposal must also include ",(0,o.kt)("inlineCode",{parentName:"li"},"--prev-governance-action-tx-id")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"--prev-governance-action-index"),".")),(0,o.kt)("h4",{id:"update-committee-to-remove-an-existing-cc-member"},"Update committee to ",(0,o.kt)("em",{parentName:"h4"},"remove")," an existing CC member:"),(0,o.kt)("p",null,"Assume that you want to remove the CC member with the key hash ",(0,o.kt)("inlineCode",{parentName:"p"},"89181f26b47c3d3b6b127df163b15b74b45bba7c3b7a1d185c05c2de"),". You can do this with:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway governance action update-committee \\\n  --testnet \\\n  --governance-action-deposit $(cardano-cli conway query gov-state --testnet-magic 4 | jq -r '.currentPParams.govActionDeposit') \\\n  --deposit-return-stake-verification-key-file stake.vkey \\\n  --anchor-url https://raw.githubusercontent.com/Ryun1/metadata/main/cip108/treasury-withdrawal.jsonld \\\n  --anchor-data-hash 931f1d8cdfdc82050bd2baadfe384df8bf99b00e36cb12bfb8795beab3ac7fe5 \\\n  --remove-cc-cold-verification-key-hash 89181f26b47c3d3b6b127df163b15b74b45bba7c3b7a1d185c05c2de \\\n  --threshold 1/2 \\\n  --prev-governance-action-tx-id fe2c99fe6bc75a9666427163d51ae7dbf5a60df40135361b7bfd53ac6c7912ec \\\n  --prev-governance-action-index 0 \\\n  --out-file update-committee.action\n")),(0,o.kt)("h4",{id:"update-committee-to-only-change-the-threshold"},"Update committee to only change the ",(0,o.kt)("em",{parentName:"h4"},"threshold"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway governance action update-committee \\\n  --testnet \\\n  --governance-action-deposit $(cardano-cli conway query gov-state --testnet-magic 4 | jq -r '.currentPParams.govActionDeposit') \\\n  --deposit-return-stake-verification-key-file stake.vkey \\\n  --anchor-url https://raw.githubusercontent.com/Ryun1/metadata/main/cip108/treasury-withdrawal.jsonld \\\n  --anchor-data-hash 931f1d8cdfdc82050bd2baadfe384df8bf99b00e36cb12bfb8795beab3ac7fe5 \\\n  --threshold 60/100 \\\n  --prev-governance-action-tx-id fe2c99fe6bc75a9666427163d51ae7dbf5a60df40135361b7bfd53ac6c7912ec \\\n  --prev-governance-action-index 0 \\\n  --out-file update-committee.action\n")),(0,o.kt)("h2",{id:"updating-the-constitution"},"Updating the constitution"),(0,o.kt)("p",null,"This section describes how to propose a new constitution. Lets's use as an axample the interim constitution that is to be used\non Mainnet. It is available in ",(0,o.kt)("a",{parentName:"p",href:"https://ipfs.io/ipfs/Qmdo2J5vkGKVu2ur43PuTrM7FdaeyfeFav8fhovT6C2tto"},"https://ipfs.io/ipfs/Qmdo2J5vkGKVu2ur43PuTrM7FdaeyfeFav8fhovT6C2tto")),(0,o.kt)("h4",{id:"find-the-last-enacted-constitution-governance-action"},"Find the last enacted Constitution governance action"),(0,o.kt)("p",null,"Find the last enacted governance action of this type, If the query returns ",(0,o.kt)("inlineCode",{parentName:"p"},"null")," it means the current consitution (if it exists) is not enacted in a governance action,\nbut instead supplied on the Conway genesis file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cardano-cli conway query gov-state --testnet-magic 4 | jq -r '.nextRatifyState.nextEnactState.prevGovActionIds.Constitution'\nnull\n")),(0,o.kt)("p",null,"When the constitution has been enacted through a governance action, you will see the transaction ID and index of the proposing transaction, we will use this information later:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'cardano-cli conway query gov-state | jq -r \'.nextRatifyState.nextEnactState.prevGovActionIds.Constitution\'\n{\n  "govActionIx": 0,\n  "txId": "bf4832f443fe34f26f929ce2fbb26cc35ef4fda31150b2da45969a9bac4f7a8c"\n}\n')),(0,o.kt)("h4",{id:"prepare-the-constiuttion-anchor"},"Prepare the constiuttion anchor."),(0,o.kt)("p",null,"When proposing a new constitution, you are required to put it on a URL that is publicly accessible and, idealy, in some sort of persistent form. For example\nput it on IPFS, like the ",(0,o.kt)("a",{parentName:"p",href:"https://ipfs.io/ipfs/Qmdo2J5vkGKVu2ur43PuTrM7FdaeyfeFav8fhovT6C2tto"},"interim constitution")),(0,o.kt)("p",null,"Now, download the file from the url:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"wget https://ipfs.io/ipfs/Qmdo2J5vkGKVu2ur43PuTrM7FdaeyfeFav8fhovT6C2tto -O constitution.txt\n")),(0,o.kt)("p",null,"Get its hash, you can do it with blake2 or with cardano-cli:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"b2sum -l 256 constitution.txt\na77245f63bc7504c6ce34383633729692388dc1823723b0ee9825743a87a6a6d  constitution.txt\n")),(0,o.kt)("p",null,"or"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway governance hash anchor-data --file-text constitution.txt\na77245f63bc7504c6ce34383633729692388dc1823723b0ee9825743a87a6a6d\n")),(0,o.kt)("h4",{id:"the-guardrails-script"},"The guardrails script"),(0,o.kt)("p",null,"The Guardrails script is soon to be open sourced, you will find it here: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/IntersectMBO/constitution-priv"},"https://github.com/IntersectMBO/constitution-priv")," "),(0,o.kt)("p",null,"Follow the instructions in the README.md file to compile the PlutusV3 script. A successful compilation creates the 'compiled' directory containing the script in a text envelope."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cat compiled/guardrails-script.plutus \n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n    "type": "PlutusScriptV3",\n    "description": "",\n    "cborHex": "59082f59082c0101003232323232323232323232323232323232323232323232323232323232323232323232323232323232323225932325333573466e1d2000001180098121bab357426ae88d55cf001054ccd5cd19b874801000460042c6aae74004dd51aba1357446ae88d55cf1baa325333573466e1d200a35573a00226ae84d5d11aab9e0011637546ae84d5d11aba235573c6ea800642b26006003149a2c8a4c3021801c0052000c00e0070018016006901e40608058c00e00290016007003800c00b0034830268320306007001800600690406d6204e00060001801c0052004c00e007001801600690404001e0006007001800600690404007e00060001801c0052006c00e006023801c006001801a4101000980018000600700148023003801808e0070018006006904827600060001801c005200ac00e0070018016006904044bd4060c00e003000c00d2080ade204c000c0003003800a4019801c00e003002c00d2080cab5ee0180c100d1801c005200ec00e0060238000c00e00290086007003800c00b003483d00e0306007001800600690500fe00040243003800a4025803c00c01a0103003800a4029803c00e003002c00cc07520d00f8079801c006001801980ea4120078001800060070014805b00780180360070018006006603e900a4038c0003003800a4041801c00c04601a3003800a4045801c00e003002c00d20f02e80c1801c006001801a4190cb80010090c00e00290126000c00e0029013600b003803c00e003002c00cc0752032c000c00e003000c00cc075200ac000c0006007007801c006005801980ea418170058001801c006001801980ea41209d80018000c0003003800a4051802c00e007003011c00e003000c00d2080e89226c000c0006007003801808e007001800600690406c4770b7e000600030000c00e0029015600b003801c00c047003800c00300348202e2e1cb00030001801c00e006023801c006001801a410181f905540580018000c0003003800a4059801c00c047003800c00300348203000700030000c00e00290176007003800c00b003483200603060070018006006904801e00040243003800a4061801c00c0430001801c0052032c016006003801801e00600780180140100c00e002901a600b003001c00c00f003003c00c00f003002c00c007003001c00c007003803c00e003002c00c0560184014802000c00e002901b6007003800c00b003480030034801b0001801c006001801a4029800180006007001480e3003801c006005801a4001801a40498000c00e003000c00d20ca04c00080486007001480eb00380180860070018006006900f600060001801c005203cc00e006015801c006001801a4101012bcf138c09800180006007001480fb003801805600700180060069040505bc3f482e00060001801c0052040c00e0070018016006900d4060c00e003000c00d204ac000c0003003800a4085801c00c04601630000000000200f003006c00e003000c00c05a0166000200f003005c00e003000c00c057003010c0006000200f003800c00b003012c00cc05d2028c0004008801c01e007001801600602380010043000400e003000c00c04b003011c0006000800c00b00300d8049001801600601d801980924190038000801c0060010066000801c00600900f6000800c00b003480030034820225eb0001003800c003003483403f0003000400c023000400e003000c00d208094ebdc03c000c001003009c001003300f4800b0004006005801a40058001001801401c6014900518052402860169004180424008600a900a180324005003480030001806240cc6016900d18052402460129004180424004600e900018032400c6014446666aae7c004a0005003328009aab9d0019aab9e0011aba100298019aba200224c6012444a6520071300149a4432005225900689802a4d2219002912c998099bad0020068ac99807002800c4cc03001c00e300244cc03001c02a3002012c801460012218010c00888004c004880094cc8c0040048848c8cc0088c00888c00800c8c00888c00400c8d4cc01001000cd400c0044888cc00c896400a300090999804c00488ccd5cd19b87002001800400a01522333573466e2000800600100291199ab9a33712004003000801488ccd5cd19b89002001801400244666ae68cdc4001000c00a001225333573466e240080044004400a44a666ae68cdc4801000880108008004dd6801484cc010004dd6001484c8ccc02a002452005229003912999ab9a3370e0080042666ae68cdc3801800c00200430022452005229003911980899b820040013370400400648a400a45200722333573466e20cdc100200099b82002003800400880648a400a45200722333573466e24cdc100200099b82002003801400091480148a400e44666ae68cdc419b8200400133704004007002800122593300e0020018800c400922593300e00200188014400400233323357346ae8cd5d10009198051bad357420066eb4d5d08011aba2001268001bac00214800c8ccd5cd1aba3001800400a444b26600c0066ae8400626600a0046ae8800630020c0148894ccd5cd19b87480000045854ccd5cd19b88001480004cc00ccdc0a400000466e05200000113280099b8400300199b840020011980200100098021112999ab9a3370e9000000880109980180099b860020012223300622590018c002443200522323300d225900189804803488564cc0140080322600800318010004b20051900991111111001a3201322222222005448964ce402e444444440100020018c00a30000002225333573466e1c00800460002a666ae68cdc48010008c010600445200522900391199ab9a3371266e08010004cdc1001001c0020041191800800918011198010010009"\n}\n')),(0,o.kt)("p",null,"Now, get the script hash with:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cardano-cli conway governance hash script --script-file guardrails-script.plutus \nedcd84c10e36ae810dc50847477083069db796219b39ccde790484e0\n")),(0,o.kt)("h4",{id:"create-the-proposal-to-update-the-constitution"},"Create the proposal to update the constitution:"),(0,o.kt)("p",null,"When there is no previously enacted constiutition: "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'cardano-cli conway governance action create-constitution \\\n  --testnet \\\n  --governance-action-deposit $(cardano-cli conway query gov-state --testnet-magic 4 | jq -r \'.currentPParams.govActionDeposit\') \\\n  --deposit-return-stake-verification-key-file stake.vkey \\\n  --anchor-url https://raw.githubusercontent.com/cardano-foundation/CIPs/master/CIP-0100/cip-0100.common.schema.json \\\n  --anchor-data-hash "9d99fbca260b2d77e6d3012204e1a8658f872637ae94cdb1d8a53f4369400aa9" \\\n  --constitution-url https://ipfs.io/ipfs/Qmdo2J5vkGKVu2ur43PuTrM7FdaeyfeFav8fhovT6C2tto \\\n  --constitution-hash "a77245f63bc7504c6ce34383633729692388dc1823723b0ee9825743a87a6a6d" \\\n  --constitution-script-hash "edcd84c10e36ae810dc50847477083069db796219b39ccde790484e0"\n  --out-file \n')),(0,o.kt)("p",null,"When there is a previously enacted constitution, we need to reference the previous governance action id (TXID and INDEX):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'cardano-cli conway governance action create-constitution \\\n  --testnet \\\n  --governance-action-deposit $(cardano-cli conway query gov-state --testnet-magic 4 | jq -r \'.currentPParams.govActionDeposit\') \\\n  --deposit-return-stake-verification-key-file stake.vkey \\\n  --anchor-url https://raw.githubusercontent.com/Ryun1/metadata/main/cip108/treasury-withdrawal.jsonld \\\n  --anchor-data-hash 931f1d8cdfdc82050bd2baadfe384df8bf99b00e36cb12bfb8795beab3ac7fe5 \\\n  --constitution-url https://ipfs.io/ipfs/Qmdo2J5vkGKVu2ur43PuTrM7FdaeyfeFav8fhovT6C2tto \\\n  --constitution-hash "a77245f63bc7504c6ce34383633729692388dc1823723b0ee9825743a87a6a6d" \\\n  --constitution-script-hash "edcd84c10e36ae810dc50847477083069db796219b39ccde790484e0" \\\n  --prev-governance-action-tx-id "bf4832f443fe34f26f929ce2fbb26cc35ef4fda31150b2da45969a9bac4f7a8c" \\\n  --prev-governance-action-index 0 \\\n  --out-file constitution.action\n')),(0,o.kt)("p",null,"From here, you just need to ",(0,o.kt)("a",{parentName:"p",href:"#submitting-the-action-file-in-a-transaction"},"submit the proposal in a transaction")," "),(0,o.kt)("p",null,"Should you decide to propose an update to the SanchoNet constitution, please note that all rules and principles outlined for SanchoNet should be fictional and unrelated to the actual rules on the Cardano blockchain. Quotes directly from Don Quixote\nare encouraged, as well as rules in a similar spirit that aren't directly extracted from the book. SanchoNet is not the space for serious discussions about the future governance of Cardano. For substantial conversations, please visit\nthe dedicated forum to explore the weighty matters of Cardano's constitution with the depth they deserve. ",(0,o.kt)("a",{parentName:"p",href:"https://forum.cardano.org/c/governance/constitution/212"},"Cardano Forum")),(0,o.kt)("h2",{id:"motion-of-no-confidence"},"Motion of no confidence"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Find the last governance action enacted of this type:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway query gov-state --testnet-magic 4 | jq -r '.nextRatifyState.nextEnactState.prevGovActionIds.Committee'\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "govActionIx": 0,\n  "txId": "fe2c99fe6bc75a9666427163d51ae7dbf5a60df40135361b7bfd53ac6c7912ec"\n}\n')),(0,o.kt)("h4",{id:"create-a-no-confidence-governance-action"},"Create a no-confidence governance action:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway governance action create-no-confidence \\\n  --testnet \\\n  --governance-action-deposit $(cardano-cli conway query gov-state --testnet-magic 4 | jq -r '.currentPParams.govActionDeposit') \\\n  --deposit-return-stake-verification-key-file stake.vkey \\\n  --anchor-url https://raw.githubusercontent.com/Ryun1/metadata/main/cip108/treasury-withdrawal.jsonld \\\n  --anchor-data-hash 931f1d8cdfdc82050bd2baadfe384df8bf99b00e36cb12bfb8795beab3ac7fe5 \\\n  --prev-governance-action-tx-id fe2c99fe6bc75a9666427163d51ae7dbf5a60df40135361b7bfd53ac6c7912ec \\\n  --prev-governance-action-index 0 \\\n  --out-file no-confidence.action\n")),(0,o.kt)("h2",{id:"treasury-withdrawal"},"Treasury withdrawal"),(0,o.kt)("p",null,"In addition to the stake credential required to obtain a deposit refund, the proposer must also furnish stake credentials for receiving funds from the treasury in the\nevent that the governance action is approved."),(0,o.kt)("p",null,"Also, treasury withdrawals must reference the Guardrails script. "),(0,o.kt)("h4",{id:"create-the-treasury-withdrawal-proposal"},"Create the treasury withdrawal proposal:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway governance action create-treasury-withdrawal \\\n  --testnet \\\n  --governance-action-deposit $(cardano-cli conway query gov-state --testnet-magic 4 | jq -r '.currentPParams.govActionDeposit') \\\n  --deposit-return-stake-verification-key-file stake.vkey \\\n  --anchor-url https://raw.githubusercontent.com/Ryun1/metadata/main/cip108/treasury-withdrawal.jsonld \\\n  --anchor-data-hash 931f1d8cdfdc82050bd2baadfe384df8bf99b00e36cb12bfb8795beab3ac7fe5 \\\n  --funds-receiving-stake-verification-key-file stake.vkey \\\n  --constitution-script-hash \"edcd84c10e36ae810dc50847477083069db796219b39ccde790484e0\" \\\n  --transfer 50000000000 \\\n  --out-file treasury.action\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Note that you do not need to provide any previous governance action ID on treasury withdrawals.")),(0,o.kt)("h2",{id:"info"},"Info"),(0,o.kt)("h4",{id:"create-the-info-governance-action"},"Create the 'info' governance action:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway governance action create-info --testnet \\\n  --governance-action-deposit $(cardano-cli conway query gov-state --testnet-magic 4 | jq -r '.currentPParams.govActionDeposit') \\\n  --deposit-return-stake-verification-key-file stake.vkey \\\n  --anchor-url  https://tinyurl.com/yc74fxx4 \\\n  --anchor-data-hash 931f1d8cdfdc82050bd2baadfe384df8bf99b00e36cb12bfb8795beab3ac7fe5 \\\n  --out-file info.action\n")),(0,o.kt)("h2",{id:"update-protocol-parameters"},"Update protocol parameters"),(0,o.kt)("p",null,"When updating protocol parameters, you must reference the Guardrails script. This reference is not automatically inferred\nbecause, actions can be created off-line so the cli may not have access to a node, and also because a governance action may be submitted in advance,\nanticipating that a new Guardrails script will be ratified and enacted during the proposal's lifespan."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway governance action create-protocol-parameters-update \\\n  --testnet \\\n  --governance-action-deposit $(cardano-cli conway query gov-state --testnet-magic 4 | jq -r '.currentPParams.govActionDeposit') \\\n  --deposit-return-stake-verification-key-file stake.vkey \\\n  --anchor-url https://raw.githubusercontent.com/Ryun1/metadata/main/cip108/treasury-withdrawal.jsonld \\\n  --anchor-data-hash 931f1d8cdfdc82050bd2baadfe384df8bf99b00e36cb12bfb8795beab3ac7fe5 \\\n  --constitution-script-hash \"edcd84c10e36ae810dc50847477083069db796219b39ccde790484e0\" \\\n  --key-reg-deposit-amt 1000000 \\\n  --out-file pp-update.action\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Note: If there is a ",(0,o.kt)("strong",{parentName:"li"},"previously enacted")," governance action to update the protocol parameters, the proposal must also include ",(0,o.kt)("inlineCode",{parentName:"li"},"--prev-governance-action-tx-id")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"--prev-governance-action-index"),".")),(0,o.kt)("p",null,"Continue with ",(0,o.kt)("a",{parentName:"p",href:"#submitting-a-treasuy-withdrawal-and-protocol-parameter-update-governance-action"},"build, sign and submit the transactions")," "),(0,o.kt)("h2",{id:"submitting-the-action-file-in-a-transaction"},"Submitting the action file in a transaction"),(0,o.kt)("p",null,"Submitting the ",(0,o.kt)("inlineCode",{parentName:"p"},"*.action")," file to the blockchain is the essential step in bringing your proposal to life and making it accessible for the community to participate in the\nvoting process. This process essentially transforms your proposal from a conceptual idea into an actionable item. Once submitted, it becomes part of the public ledger,\nwhile also allowing members of the governance bodies to review, discuss, and ultimately cast their votes on its approval or rejection."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Note that you can also use ",(0,o.kt)("inlineCode",{parentName:"li"},"build-raw")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"calculate-min-fee")," to build transactions in an off-line settting. The example below uses the convenient ",(0,o.kt)("inlineCode",{parentName:"li"},"build"),":")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'cardano-cli conway transaction build \\\n  --testnet-magic 4 \\\n  --tx-in "$(cardano-cli query utxo --address "$(cat payment.addr)" --testnet-magic 4 --out-file /dev/stdout | jq -r \'keys[0]\')" \\\n  --change-address $(cat payment.addr) \\\n  --proposal-file info.action \\\n  --out-file tx.raw\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway transaction sign \\\n  --testnet-magic 4 \\\n  --tx-body-file tx.raw \\\n  --signing-key-file payment.skey \\\n  --out-file tx.signed\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway transaction submit \\\n  --testnet-magic 4 \\\n  --tx-file tx.signed\n")),(0,o.kt)("h2",{id:"submitting-a-treasuy-withdrawal-and-protocol-parameter-update-governance-action"},"Submitting a treasuy-withdrawal and protocol-parameter-update governance action"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"This transaction will pay the governance action deposit and fee, in addition, we must supply a collateral since we will be running a plutus script: the guardrails script.")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"At the time of writing this tutorial, the ",(0,o.kt)("inlineCode",{parentName:"p"},"build")," command has a bug that causes it to underestimate the execution units. For now we will use ",(0,o.kt)("inlineCode",{parentName:"p"},"build-raw")," instead. ")),(0,o.kt)("p",null,"Query the utxos of our address:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway query utxo --address $(cat payment.addr)\n                           TxHash                                 TxIx        Amount\n--------------------------------------------------------------------------------------\n0a2d91bcc0775581594f49eb9709108aa8b75c9f59e77774868462d8251c6b31     0        149999600000 lovelace + TxOutDatumNone\n1fa4fd83daf44c6cc2db9abd495306568b5f64b28296d4e55958bee3d9b4f90e     1        50816371 lovelace + TxOutDatumNone\nc925e0e4b83f5f36b3950f4e940f59632f9589cd9bcae4a071878a54d455a47e     0        49999690803 lovelace + TxOutDatumNone\n")),(0,o.kt)("h4",{id:"balance-the-transaction"},"Balance the transaction:"),(0,o.kt)("p",null,"We will use ",(0,o.kt)("inlineCode",{parentName:"p"},"build-raw"),", this means we need to balance the transaction manually, in other words, we need to calculate the change of the transaction ourselves so that inputs = outputs."),(0,o.kt)("p",null,"Get the value of the UTxO at index 0 (first UTxO). This will be our input (--tx-in) for the transaction."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"utxo_value=$(cardano-cli conway query utxo --address \"$(cat payment.addr)\" --output-json | jq '.[keys[0]].value.lovelace')\n")),(0,o.kt)("p",null,"We'll need to deduct the fee. For simplicity let's set the fee on 500000 lovelace:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"fee=500000\n")),(0,o.kt)("p",null,"We need to take the governance action deposit into account:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"govActDeposit=$(cardano-cli conway query gov-state | jq -r .currentPParams.govActionDeposit)\n")),(0,o.kt)("p",null,"Now we can calculate the change of the transaction. Later, we will use $change in the transaction output (--tx-out)."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"change=$(($utxo_value - $fee - $govActDeposit))\n")),(0,o.kt)("h4",{id:"build-sign-and-submit-the-transaction"},"Build, sign and submit the transaction"),(0,o.kt)("p",null,"When building the transaction, we include the ",(0,o.kt)("inlineCode",{parentName:"p"},"*.action")," file and supply the guardrails script with --proposal-script-file. Note that the guardrails script does not require a datum to be passed."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'cardano-cli conway transaction build-raw \\\n--proposal-script-file guardrails-script.plutus \\\n--tx-in-collateral "$(cardano-cli query utxo --address "$(cat payment.addr)" --output-json | jq -r \'keys[1]\')" \\\n--proposal-redeemer-value {} \\\n--proposal-execution-units  "(119000000, 555000)" \\\n--tx-in "$(cardano-cli query utxo --address "$(cat payment.addr)" --output-json | jq -r \'keys[0]\')" \\\n--tx-out "$(cat payment.addr)+$change" \\\n--fee "$fee" \\\n--protocol-params-file pparams.json \\\n--proposal-file pparams.action \\\n--out-file pparams-tx.raw\n')),(0,o.kt)("p",null,"This example uses the second UTxO (Index 1) of payment.addr as collateral: ",(0,o.kt)("inlineCode",{parentName:"p"},"$( ...--output-json | jq -r 'keys[1]').")," Adjust the command so that it accomodates to your needs and preferences of utxos to use."),(0,o.kt)("p",null,"We sign the transaction only with ",(0,o.kt)("inlineCode",{parentName:"p"},"payment.skey")," since we are using the same for fees and collateral:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway transaction sign \\\n--tx-file pparams-tx.raw \\\n--signing-key-file payment.addr \\ \n--out-file pparams-tx.signed \n")),(0,o.kt)("p",null,"And submit it to the chain with:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway transaction submit \\\n--tx-file pparams-tx.signed\n")),(0,o.kt)("h2",{id:"finding-the-governance-action-id-of-your-proposal"},"Finding the governance action ID of your proposal"),(0,o.kt)("p",null,"You may want to find your governance action ID to share it with others on Discord1 and seek their support. The transaction ID and the index of the transaction that submitted the\nproposal serve as the action ID. An effective way to find your governance action ID is by querying the governance state and filtering by (the proposer) stake key hash."),(0,o.kt)("p",null,"First, find your key hash with:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway stake-address key-hash --stake-verification-key-file stake.vkey\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"8e0debc9fdc6c616ac40d98bf3950b436895eea9cccf0396a6e5e12b")),(0,o.kt)("p",null,"Use ",(0,o.kt)("inlineCode",{parentName:"p"},"jq")," to filter the ",(0,o.kt)("inlineCode",{parentName:"p"},"gov-state")," output by the stake key hash. The output contains all the relevant information about your governance actions, including ",(0,o.kt)("inlineCode",{parentName:"p"},"actionId"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli conway query gov-state --testnet-magic 4 \\\n| jq -r --arg keyHash \"8e0debc9fdc6c616ac40d98bf3950b436895eea9cccf0396a6e5e12b\" '.proposals | to_entries[] | select(.value.returnAddr.credential.keyHash | contains($keyHash)) | .value'\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "action": {\n    "contents": [\n      [\n        {\n          "credential": {\n            "keyHash": "7249a71391f08399f06b492eae7892a33191699625cff50b7dee55c6"\n          },\n          "network": "Testnet"\n        },\n        20388738581\n      ]\n    ],\n    "tag": "TreasuryWithdrawals"\n  },\n  "actionId": {\n    "govActionIx": 0,\n    "txId": "4fcd92abf2ce3d6796c5fae51ea83d563ca8611359c9624fd1cecd7fa1ce71cc"\n  },\n  "committeeVotes": {\n    "keyHash-23e05ad2b71317a6348ce4b68dae37aa1c0e545cdea740b23c21742e": "VoteNo",\n    "keyHash-540bedcd4bdcbf523e899c3ef43f2b96ecec4f6303af58d15a413ed1": "VoteYes",\n    "keyHash-6c1d098a366f2274651943a7f778b3b5459c129f0407a0db2902253a": "VoteYes"\n  },\n  "dRepVotes": {\n    "keyHash-13797df5308dfebf2348fa58b312a177cf97939f5f7d21168e1a54db": "VoteYes",\n    "keyHash-9853551d8b99884f51608822e012bbf0d444eb7bea2807ee664f1241": "Abstain",\n    "keyHash-cf09b59e134fa14e48da39b552c02299a054d7c8b895b3d827453672": "VoteNo"\n  },\n  "deposit": 1000000000,\n  "expiresAfter": 34,\n  "proposedIn": 33,\n  "returnAddr": {\n    "credential": {\n      "keyHash": "8e0debc9fdc6c616ac40d98bf3950b436895eea9cccf0396a6e5e12b"\n    },\n    "network": "Testnet"\n  },\n  "stakePoolVotes": {}\n}\n')))}u.isMDXComponent=!0}}]);